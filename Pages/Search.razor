@page "/search"

<PageTitle>Search Albums</PageTitle>

<h1>?? Search Albums</h1>

<AlbumSearchBar OnAlbumSelected="SelectAlbum" OnSearchResults="HandleSearchResults" OnSearchPerformed="HandleSearchPerformed" />

@if (_results is not null)
{
    @if (_results.Count == 0)
    {
        <p class="mt-3">No albums found for "<strong>@_lastQuery</strong>".</p>
    }
    else
    {
        <div class="album-grid mt-3">
            @foreach (var album in _results)
            {
                <AlbumCard Album="album" Clicked="() => SelectAlbum(album)" />
            }
        </div>
    }
}

<AlbumDetailPanel Album="_selectedAlbum" OnClose="CloseDetail" />

@code {
    private string _lastQuery = string.Empty;
    private List<Album>? _results;
    private Album? _selectedAlbum;

    private void HandleSearchPerformed(string query) => _lastQuery = query;

    private void HandleSearchResults(List<Album> results) => _results = results;

    private void SelectAlbum(Album album) => _selectedAlbum = album;

    private void CloseDetail() => _selectedAlbum = null;
}
